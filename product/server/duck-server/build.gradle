buildscript { dependencies { classpath "org.springframework.boot:spring-boot-gradle-plugin:1.0.2.RELEASE" } }
apply plugin: 'java'
apply plugin: 'spring-boot'
apply plugin: 'application'

description = "The main Duck server"
archivesBaseName = "duck-server"
version = project.parent.parent.version
sourceCompatibility = 1.7
mainClassName = "se.crisp.duck.server.duck_server.DuckServerMain"

dependencies {
    compile "org.springframework.boot:spring-boot-starter-web"
    compile "org.springframework.boot:spring-boot-starter-jdbc"
    compile "org.springframework.boot:spring-boot-starter-actuator"
    compile project(":product:server:agent-delegate")
    compile libs['logback']
    compile libs['lombok']
    compile libs['flyway']
    compile libs['javax-inject']
    compile libs['h2database']

    runtime libs['jackson-datatype-json-org']

    testCompile("org.springframework.boot:spring-boot-starter-test")
}

applicationDistribution.from("src/main/resources") {
    into "conf"
    include "logback.xml", "default.properties"
    rename {
        def name = it == "default.properties" ? "application.properties" : it
        "${name}.default"
    }
}

startScripts {
    doLast {
        outputs.files.each { script ->
            logger.info "Adjusting CLASSPATH in {} to start with \$APP_HOME/conf/ ...", script.name
            def text = script.text
            text = text.replace('CLASSPATH=$APP_HOME/lib', 'CLASSPATH=$APP_HOME/conf/:$APP_HOME/lib')
            script.text = text
        }
    }
}
