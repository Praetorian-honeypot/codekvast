<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" ng-app="codekvastApp" ng-strict-di="true">
<head>
    <th:block th:include="fragments :: #head-boilerplate"/>
    <th:block th:include="fragments :: #head-disable-caching"/>
    <title>Codekvast</title>
</head>

<body>
<div class="container-fluid" ng-controller="MainController">
    <div class="ng-cloak">
        <div class="row">
            <div class="col-lg-offset-4 col-lg-6"><h1>Codekvast Invocation Data</h1></div>
            <div class="col-lg-2">
                <form class="form-aaa" role="form" th:action="@{/logout}" method="post">
                    <div class="form-group">
                        <p class="form-control-static" th:text="${'Logged in as ' + #httpServletRequest.remoteUser}">sample_user</p>

                        <input class="btn btn-default" type="submit" value="Log out"/>
                    </div>
                </form>
            </div>
        </div>

        <div class="jumbotron" ng-show="jumbotronMessage"><h2>{{jumbotronMessage}}</h2></div>

        <div class="panel panel-info" ng-show="collectorStatus">
            <div class="panel-heading" ng-click="statusPanelOpen = !statusPanelOpen">Collector status <i class="pull-right glyphicon"
                                                                                                         ng-class="{'glyphicon-chevron-down': statusPanelOpen, 'glyphicon-chevron-right': !statusPanelOpen}"></i>
            </div>
            <div collapse="!statusPanelOpen">
                <div class="panel-body">
                    <p>The status of all collectors that deliver data to this server.</p>
                </div>
                <table class="table collector-status">
                    <thead>
                    <tr>
                        <th class="col-lg-2">Application</th>
                        <th class="col-lg-1">Version</th>
                        <th class="col-lg-1">Collection started at</th>
                        <th class="col-lg-1"/>
                        <th class="col-lg-1">Data received at</th>
                        <th class="col-lg-1"/>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="c in collectorStatus.collectors">
                        <td class="col-lg-2">{{c.name}}</td>
                        <td class="col-lg-1">{{c.version}}</td>
                        <td class="col-lg-1">{{c.collectorStartedAt}}</td>
                        <td class="col-lg-1 collector-age">{{c.collectorAge}}</td>
                        <td class="col-lg-1">{{c.updateReceivedAt}}</td>
                        <td class="col-lg-1 collector-age">{{c.updateAge}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="panel panel-info" ng-show="signatures">
            <div class="panel-heading">Signatures</div>

            <div class="panel-body">
                Filter:
                <input type="text" ng-model="filter" size="50"/>
                Max rows:
                <input type="number" step="10" ng-model="maxRows"/>
                of {{signatures.length}}
            </div>

            <table class="table table-striped table-hover table-condensed">
                <thead>
                <tr>
                    <th class="signature-name"><a href="" ng-click="orderByName(); reverse = !reverse">Name</a></th>
                    <th class="signature-invoked-at"><a href="" ng-click="orderByInvokedAt(); reverse = !reverse">Invoked&nbsp;At</a>
                    </th>
                </tr>
                </thead>

                <tbody>
                <tr ng-repeat="s in signatures | filter: filter | orderBy:sortField:reverse | limitTo:maxRows">
                    <td class="signature-name">{{::s.name}}</td>
                    <td class="signature-invoked-at">{{s.invokedAtString}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<th:block th:include="fragments :: #scripts-twitter-bootstrap"/>
<th:block th:include="fragments :: #scripts-angularjs"/>
<th:block th:include="fragments :: #scripts-sockjs"/>
<script th:src="@{/app/codekvast.js}"></script>
</body>
</html>
