<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" ng-app="codekvastApp" ng-strict-di="true">
<head>
    <th:block th:include="fragments :: #head-boilerplate"/>
    <th:block th:include="fragments :: #head-disable-caching"/>
    <title>Codekvast</title>
</head>

<body>
<div class="container-fluid ng-cloak">
    <div class="row">
        <div class="col-lg-offset-4 col-lg-6"><h1>Codekvast Invocation Data</h1></div>
        <div class="col-lg-2">
            <form class="form-aaa" role="form" th:action="@{/logout}" method="post">
                <div class="form-group">
                    <p class="form-control-static" th:text="${'Logged in as ' + #httpServletRequest.remoteUser}">sample_user</p>

                    <input class="btn btn-default" type="submit" value="Log out"/>
                </div>
            </form>
        </div>
    </div>

    <div ng-controller="MainController">
        <div class="jumbotron" ng-show="jumbotronMessage"><h2>{{jumbotronMessage}}</h2></div>
    </div>

    <div ng-controller="CollectorController">
        <div class="panel panel-info" ng-show="collectorStatus">
            <div class="panel-heading" ng-click="statusPanelOpen = !statusPanelOpen">Collector status <i class="pull-right glyphicon"
                                                                                                         ng-class="{'glyphicon-chevron-down': statusPanelOpen, 'glyphicon-chevron-right': !statusPanelOpen}"></i>
            </div>
            <div collapse="!statusPanelOpen">
                <div class="panel-body">
                    <p>The status of all collectors that deliver data to this server.</p>
                </div>
                <table class="table collector-status">
                    <thead>
                    <tr>
                        <th class="col-lg-1">Application</th>
                        <th class="col-lg-1">Version</th>
                        <th class="col-lg-1">Host</th>
                        <th class="col-lg-1">Collection Started At</th>
                        <th class="col-lg-1">Usage Cycle</th>
                        <th class="col-lg-1" title="Time since collector started">Collector Age</th>
                        <th class="col-lg-1" title="Time left until you can identify Truly Dead Code">Time to Full Usage Cycle</th>
                        <th class="col-lg-1" title="Time point when the collector uploaded data">Data Received At</th>
                        <th class="col-lg-1">Data Age</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="c in collectorStatus.collectors">
                        <td class="col-lg-1">{{c.name}}</td>
                        <td class="col-lg-1">{{c.version}}</td>
                        <td class="col-lg-1">{{c.hostname}}</td>
                        <td class="col-lg-1">{{c.startedAtMillis|date:dateFormat}}</td>
                        <td class="col-lg-1">{{c.trulyDeadAfter}}</td>
                        <td class="col-lg-1">{{c.collectorAge}}</td>
                        <td class="col-lg-1 collector-age">{{c.countDown}}</td>
                        <td class="col-lg-1">{{c.dataReceivedAtMillis|date:dateFormat}}</td>
                        <td class="col-lg-1 collector-age">{{c.updateAge}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div ng-controller="SignatureController">
        <div class="panel panel-info" ng-show="allSignatures">
            <div class="panel-heading">Signatures</div>

            <div class="panel-body">

                <form class="form form-inline">
                    <div class="input-group">
                        <span class="input-group-addon">Minimum age</span>
                        <input class="form-control" type="number" step="{{minimumAge.step}}" ng-model="minimumAge.value"/>
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{minimumAge.unit}} <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                <li><a href="#" ng-click="minimumAge.unit = 'minutes'; minimumAge.step = 15">minutes</a></li>
                                <li><a href="#" ng-click="minimumAge.unit = 'hours'; minimumAge.step = 6">hours</a></li>
                                <li><a href="#" ng-click="minimumAge.unit = 'days'; minimumAge.step = 1">days</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="input-group">
                        <span class="input-group-addon">Filter</span>
                        <input class="form-control" type="text" placeholder="free text filter" ng-model="filter" size="50"/>
                    </div>

                    <div class="input-group">
                        <span class="input-group-addon">Max rows</span>
                        <input class="form-control" type="number" step="10" ng-model="maxRows"/>
                        <span class="input-group-addon">of {{allSignatures.length}}</span>
                    </div>
                </form>

            </div>

            <table class="table table-striped table-hover table-condensed">
                <thead>
                <tr class="row">
                    <th class="col-lg-9 signature-name"><a href="" ng-click="orderByName(); reverse = !reverse">Name</a></th>
                    <th class="col-lg-2 signature-invoked-at"><a href=""
                                                                 ng-click="orderByInvokedAt(); reverse = !reverse">Invoked&nbsp;At</a></th>
                </tr>
                </thead>

                <tbody>
                <tr class="row" ng-repeat="s in filteredSignatures | filter: filter | orderBy:sortField:reverse | limitTo:maxRows">
                    <td class="col-lg-9 signature-name">{{::s.name}}</td>
                    <td class="col-lg-2 signature-invoked-at">{{::s.invokedAtMillis | invokedAtDate:'short'}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<th:block th:include="fragments :: #scripts-twitter-bootstrap"/>
<th:block th:include="fragments :: #scripts-angularjs"/>
<th:block th:include="fragments :: #scripts-sockjs"/>
<script th:src="@{/app/codekvast.js}"></script>
</body>
</html>
