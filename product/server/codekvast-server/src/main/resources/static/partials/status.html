<div ng-controller="JumbotronController">
    <div class="jumbotron" ng-show="jumbotronMessage"><h2>{{jumbotronMessage}}</h2></div>
</div>

<div ng-controller="CollectorController">
    <div ng-show="collectorStatus" class="panel panel-info" ng-model="collectorStatusCollapsed" bs-collapse="true">
        <div class="panel-heading" bs-collapse-toggle="0">
            <h4 class="panel-title">
                <a>Collector status <i class="pull-right glyphicon"
                                       ng-class="{'glyphicon-chevron-down': !collectorStatusCollapsed, 'glyphicon-chevron-right':   collectorStatusCollapsed}"></i>
                </a>
            </h4>
        </div>
        <div class="panel-collapse" bs-collapse-target="true">
            <div class="panel-body">
                <p>The status of all collectors that deliver data to this server.</p>
            </div>
            <table class="table collector-status">
                <thead>
                <tr>
                    <th class="col-lg-1">Application</th>
                    <th class="col-lg-1">Version</th>
                    <th class="col-lg-1">Host</th>
                    <th class="col-lg-1">Collection Started At</th>
                    <th class="col-lg-1">Usage Cycle</th>
                    <th class="col-lg-1" title="Time since collector started">Collector Age</th>
                    <th class="col-lg-1" title="Time left until you can identify Truly Dead Code">Time to Full Usage Cycle</th>
                    <th class="col-lg-1" title="Time point when the collector uploaded data">Data Received At</th>
                    <th class="col-lg-1">Data Age</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="c in collectorStatus.collectors">
                    <td class="col-lg-1">{{c.name}}</td>
                    <td class="col-lg-1">{{c.version}}</td>
                    <td class="col-lg-1">{{c.hostname}}</td>
                    <td class="col-lg-1">{{c.startedAtMillis|date:dateFormat}}</td>
                    <td class="col-lg-1">{{c.trulyDeadAfter}}</td>
                    <td class="col-lg-1">{{c.collectorAge}}</td>
                    <td class="col-lg-1 collector-age">{{c.countDown}}</td>
                    <td class="col-lg-1">{{c.dataReceivedAtMillis|date:dateFormat}}</td>
                    <td class="col-lg-1 collector-age">{{c.updateAge}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div ng-controller="SignatureController">
    <div ng-show="allSignatures" class="panel panel-info" ng-model="trulyDeadSignaturesCollapsed" bs-collapse="true">
        <div class="panel-heading" bs-collapse-toggle="0">
            <a>Truly Dead Signatures <i class="pull-right glyphicon"
                                        ng-class="{'glyphicon-chevron-down': !trulyDeadSignaturesCollapsed, 'glyphicon-chevron-right': trulyDeadSignaturesCollapsed}"> </i>
            </a>
        </div>

        <div class="panel-collapse" bs-collapse-target="true">
            <div class="panel-body">

                <form class="form form-inline">
                    <fieldset>
                        <legend class="smaller">Filter</legend>

                        <div class="input-group">
                        <span class="input-group-addon">Invoked before</span>
                        <input class="form-control col-lg-1" type="number" min="0" step="{{filter.ageStep}}" ng-model="filter.minAgeValue"/>
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{filter.ageUnit}}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                <li><a href="#" ng-click="setAgeUnit(0)">minutes</a></li>
                                <li><a href="#" ng-click="setAgeUnit(1)">hours</a></li>
                                <li><a href="#" ng-click="setAgeUnit(2)">days</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="input-group">
                        <span class="input-group-addon">Name filter</span>
                        <input class="form-control" type="text" placeholder="free text name filter" ng-model="filter.signature" size="50"/>
                    </div>

                    <div class="input-group">
                        <span class="input-group-addon">Max rows</span>
                        <input class="form-control" type="number" min="0" step="10" ng-model="filter.maxRows"/>
                        <span class="input-group-addon">of {{allSignatures.length}}</span>
                    </div>
                    <div class="input-group">
                        Result: {{trulyDeadSignatures.length}} signatures
                    </div>
                    </fieldset>
                    <fieldset>
                        <legend class="smaller">Result</legend>
                        <table class="table table-striped table-hover table-condensed">
                            <thead>
                            <tr class="row">
                                <th class="col-lg-9 signature-name">Name</th>
                                <th class="col-lg-2 signature-invoked-at">Invoked&nbsp;At</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr class="row" ng-repeat="s in trulyDeadSignatures">
                                <td class="col-lg-9 signature-name">{{::s.name}}</td>
                                <td class="col-lg-2 signature-invoked-at">{{::s.invokedAtMillis | invokedAtDate:'short'}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>

    <div ng-show="newestSignatures" class="panel panel-info" ng-model="newestSignaturesCollapsed" bs-collapse="true">
        <div class="panel-heading" bs-collapse-toggle="0">
            <a>Newest Signatures <i class="pull-right glyphicon"
                                    ng-class="{'glyphicon-chevron-down': !newestSignaturesCollapsed, 'glyphicon-chevron-right': newestSignaturesCollapsed}"></i>
            </a>
        </div>
        <div class="panel-collapse" bs-collapse-target="true">
            <table class="table table-striped table-hover table-condensed">
                <thead>
                <tr class="row">
                    <th class="col-lg-9 signature-name">Name</th>
                    <th class="col-lg-2 signature-invoked-at">Invoked&nbsp;At</th>
                    <th class="col-lg-2 signature-age">Age</th>
                </tr>
                </thead>

                <tbody>
                <tr class="row" ng-repeat="s in newestSignatures">
                    <td class="col-lg-9 signature-name">{{::s.name}}</td>
                    <td class="col-lg-2 signature-invoked-at">{{::s.invokedAtMillis | invokedAtDate:'short'}}</td>
                    <td class="col-lg-2 signature-age">{{s.invocationAge}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
