//--- Docker ---------------------------------------------------------------------------------------

ext.warehouseImageName = 'crisp/codekvast-warehouse'

task pullLatestDockerImage(type: Exec) {
    description "Pulls the latest $warehouseImageName from Docker Hub"
    group 'Distribution'
    commandLine 'docker', 'pull', "$warehouseImageName:latest"
    ignoreExitValue true
}

distDocker {
    description "Builds the Docker image $warehouseImageName:latest"
    group 'Distribution'
    baseImage 'java:8-jre'
    maintainer 'Olle Hallin "olle.hallin@crisp.se"'
    runCommand 'mkdir -p /var/log /tmp/codekvast'
    volume '/var/log'
    volume '/tmp/codekvast'
    tagVersion 'latest'

    dependsOn ':product:warehouse:test', pullLatestDockerImage
}
