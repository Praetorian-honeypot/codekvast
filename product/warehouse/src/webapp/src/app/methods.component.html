<div class="container-fluid">
    <form (ngSubmit)="search()" #searchForm="ngForm">
        <div class="form-group row">
            <label for="signature" class="col-2 col-form-label">Signature</label>
            <div class="col-6">
                <input class="form-control"
                       id="signature"
                       name="signature"
                       [(ngModel)]="signature"
                       type="text"
                       placeholder="Search method signature">
            </div>
        </div>
        <div class="form-group row">
            <label for="maxResults" class="col-2 col-form-label">Max&nbsp;Results</label>
            <div class="col-2">
                <input class="form-control" id="maxResults" name="maxResults" [(ngModel)]="maxResults" type="number" min="1" max="10000">
            </div>
            <button type="submit" class="btn btn-primary btn-sm" [disabled]="!searchForm.form.valid">Search
            </button>

            <div *ngIf="data">
                <small class="ml-2 col-form-label form-text text-muted">{{ data.timestamp | date:'shortTime' }}: Found {{data.numMethods}} methods in {{data.queryTimeMillis}} ms</small>
            </div>

            <div *ngIf="errorMessage">
                <small class="ml-2 col-form-label form-text text-muted" title="{{ errorMessage }}">{{ communicationFailure() }}</small>
            </div>
        </div>
    </form>
</div>

<div *ngIf="sortedMethods()">
    <table id="search-results" class="table table-responsive table-striped table-bordered table-sm">
        <thead>
        <tr>
            <th class="signature-column" (click)="sortBySignature()">Signature <i [ngClass]="headerIconClassesSignature()" aria-hidden="true"></i></th>
            <th class="age-column" (click)="sortByAge()">Last Invoked <i [ngClass]="headerIconClassesAge()" aria-hidden="true"></i></th>
        </tr>
        </thead>

        <tbody>
        <tr *ngFor="let method of sortedMethods()"
            (mouseenter)="selectMethod(method)"
            [class.table-active]="isSelectedMethod(method)">

            <td class="signature-column wrap-word">{{method.signature}}</td>
            <td class="age-column wrap-word" title="{{method.lastInvokedAtMillis | ckAge:'short'}}">{{method.lastInvokedAtMillis | ckAge:dateFormat }}</td>
        </tr>
        </tbody>
    </table>

    <div *ngIf="selectedMethod" id="method-collection-overview">
        <table class="table table-bordered table-sm">
            <thead>
            <tr>
                <th colspan="2">Method {{ selectedMethod.id}} Overview
                    <button type="button" class="close" aria-label="Close" (click)="selectMethod(null)">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </th>
            </tr>
            </thead>

            <tbody>
            <tr>
                <th colspan="2">Appears in environments</th>
            </tr>
            <ng-container *ngFor="let env of selectedMethod.collectedInEnvironments">
                <tr>
                    <td>Name:</td>
                    <td>{{ env.name }}</td>
                </tr>
                <tr>
                    <td>Collected days:</td>
                    <td>{{ env.collectedDays }}</td>
                </tr>
                <tr>
                    <td>Collected since:</td>
                    <td>{{ env.collectedSinceMillis | ckAge:'short' }}</td>
                </tr>
                <tr>
                    <td>Collected to:</td>
                    <td>{{ env.collectedToMillis | ckAge:'short' }}</td>
                </tr>
                <tr>
                    <td>Last invoked:</td>
                    <td>{{ env.invokedAtMillis | ckAge:'short' }}</td>
                </tr>
                <tr>
                    <td>Hosts:</td>
                    <td>{{ env.hostNames.join(', ') }}</td>
                </tr>
            </ng-container>
            <tr>
                <th colspan="2">Appears in applications</th>
            </tr>

            <ng-container *ngFor="let app of selectedMethod.occursInApplications">
                <tr>
                    <td>Name:</td>
                    <td>{{ app.name }} {{ app.version }}</td>
                </tr>
                <tr title="{{ prettyPrintAppStatus(app.status) }}">
                    <td>Last invoked:</td>
                    <td>{{ app.invokedAtMillis | ckAge:'short' }}</td>
                </tr>
            </ng-container>
            </tbody>
        </table>

        <!--
            tags: string[];
            collectedInEnvironments: Environment[];
            occursInApplications: Application[];
        -->
    </div>
</div>
